<!DOCTYPE html>
<html lang="fr">

<head>
    <title>Modify Material</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/fonts/roboto-font.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/animated_background.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/x-icon">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/x-icon">
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet" id="bootstrap-css">
    <script src="/static/js/jquery-3.6.4.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <style>
        .portainer {
               display: flex;
               justify-content: center;
               align-items: center;
               z-index: 2;
               width: auto;
               margin: 0 auto 70px;
            }

            form {
                background-color: #f2f2f2;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            }
    </style>
</head>

<body>
    <ul class="horizontal">
        <li><a href="/">Project Modulus 164</a></li>
        <li><a href="/materiel">Matériel</a></li>
        <li><a href="/personnes">Personnes</a></li>
        <li><a href="/marques">Marques</a></li>
        <li><a class="active" href="/categorie">Catégorie</a></li>
        <li class="rightli" style="float:right"><a href="/about">À propos</a></li>
    </ul>
    <div class="rounded-box">
        <div style="padding-left: 30px;">
            <h1>Modify Marque</h1>
            <p>Page de modification de données.</p>
        </div>
    </div>
    <div class="portainer">
        <form action="/modify_materiel/{{id_materiel}}" method="post">
            <label for="id_mat">ID:</label><br>
            <input type="text" id="id_mat" name="id_mat" value="{{ material[0] }}"><br><br>
            <label for="nom_mat">Nom:</label><br>
            <input type="text" id="nom_mat" name="nom_mat" value="{{ material[1] }}"><br><br>
            <label for="model_mat">Modèle:</label><br>
            <input type="text" id="model_mat" name="model_mat" value="{{ material[2] }}"><br><br>
            <label for="serial_num">Numéro de série:</label><br>
            <input type="text" id="serial_num" name="serial_num" value="{{ material[3] }}"><br><br>
            <label for="date_achat">Date d'achat:</label><br>
            <input type="datetime-local" id="date_achat" name="date_achat" value="{{ material[4].strftime('%Y-%m-%dT%H:%M') }}"><br><br>
            <label for="date_expi">Date d'expiration:</label><br>
            <input type="datetime-local" id="date_expi" name="date_expi" value="{{ material[5].strftime('%Y-%m-%dT%H:%M') }}"><br><br>
            <label for="prix_mat">Prix:</label><br>
            <input type="text" id="prix_mat" name="prix_mat" value="{{ material[6] }}"><br><br>
            <label for="nom_cat">Catégorie:</label><br>
            <select id="nom_cat" name="nom_cat">
                {% for category in categories %}
                {% if category[0] == material[7] %}
                <option selected>{{ category[0] }}</option>
                {% else %}
                <option>{{ category[0] }}</option>
                {% endif %}
                {% endfor %}
            </select><br><br>
            <input type="submit" value="Modifier">
        </form>
    </div>
    <script>
        let materiel_id = {{ id_materiel }};
    </script>
    <script>
        // Validate date fields to ensure that the expiration date is greater than the purchase date
        document.querySelector("form").addEventListener("submit", function() {
            let dateAchat = new Date(document.querySelector("#date_achat").value);
            let dateExpi = new Date(document.querySelector("#date_expi").value);
            if (dateExpi <= dateAchat) {
                alert("La date d'expiration doit être supérieure à la date d'achat.");
                event.preventDefault();
            }
        });

        // pre-fill the form with the existing data for this material
        fetch("/get_row_data?id=" + materiel_id)
            .then(response => response.json())
            .then(data => {
                document.querySelector("#id_materiel").value = data.id_mat;
                document.querySelector("#nom_mat").value = data.nom_mat;
                document.querySelector("#model_mat").value = data.model_mat;
                document.querySelector("#serial_num").value = data.serial_num;
                document.querySelector("#date_achat").value = data.date_achat;
                document.querySelector("#date_expi").value = data.date_expi;
                document.querySelector("#prix_mat").value = data.prix_mat;
                document.querySelector("#nom_cat").value = data.nom_cat;
            });
    </script>
    {% include '/actions/background-boxes.html' %} {% include 'footer.html' %}
</body>

</html>